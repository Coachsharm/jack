# dashboard - Dashboard Management Skill

**Purpose:** Manage the Thrive Works Dashboard at http://sites.thriveworks.tech/dashboard/

**Reference:** `lessons/dashboard-management-plan-2026-02-13.md`

---

## Trigger

User says:
- "update dashboard"
- "add dashboard panel"
- "edit dashboard"
- "fix dashboard"
- "dashboard [action]"
- "/dashboard"

---

## Dashboard Overview

**Live URL:** http://sites.thriveworks.tech/dashboard/

**Location:** `/var/www/sites/dashboard/`

**What it displays:**
- **Agent Cards** (Jack, Ross, Sarah, John) with:
  - Online status
  - **Model health** (üü¢ working / üî¥ error with last working model)
    - *Note: Passive check by default (API safe). Active probe runs only on manual refresh.*
  - Heartbeat status
  - Session count
- API Usage (Faith/Guru accounts - Claude, Gemini, Codex)
- Channels (Telegram, WhatsApp)
- Brain Capacity (Memory file sizes, context usage)
- Urgent Alerts (Recent emails, upcoming calendar events)

---

## Key Files

### Frontend
- **`index.html`** ‚Äî Main dashboard (HTML/CSS/JS)

### Data (Generated by scripts)
- **`status.json`** ‚Äî Current status (updated every minute)
- **`history.json`** ‚Äî Brain capacity history (updated hourly)
- **`usage_history.json`** ‚Äî API usage history (updated every minute)
- **`auth_summary.json`** ‚Äî Auth status (updated every 30 min)

### Scripts (Data generators)
- **`/root/.openclaw/workspace/scripts/update_dashboard_json.py`** ‚Äî Main status updater
- **`/var/www/sites/dashboard/update_history.py`** ‚Äî Brain history updater
- **`/var/www/sites/dashboard/update_auth_summary.sh`** ‚Äî Auth summary updater

### Brain Mirror
- **`/var/www/sites/dashboard/brain_mirror/sarah/workspace/`** ‚Äî Mirror of bot workspace files

---

## Functions

### 1. View Current Panels

**Trigger:** "show dashboard panels" / "list dashboard panels"

**Action:**
1. Read `index.html` to identify all panels
2. List each panel with:
   - Name
   - Data source (which JSON file/field)
   - Update frequency
   - Current status

**Output:**
```
üìä Dashboard Panels:

1. API Usage Panel
   - Data: status.json (faith, guru, codex)
   - Updates: Every minute
   - Status: ‚úÖ Active

2. Bot Squad Panel
   - Data: status.json (squad array)
   - Updates: Every minute
   - Status: ‚úÖ Active

3. Urgent Alerts Panel
   - Data: status.json (emails, calendar)
   - Updates: Every minute
   - Status: ‚úÖ Active

4. Brain Capacity Panel
   - Data: status.json (brain object)
   - Updates: Every minute
   - Status: ‚úÖ Active

5. Historical Charts Panel
   - Data: history.json (hourly, daily)
   - Updates: Hourly
   - Status: ‚úÖ Active
```

---

### 2. Add New Panel

**Trigger:** "add dashboard panel for [topic]"

**Process:**

1. **Ask what data to display**
   - What metrics/info?
   - Where does data come from?
   - How often should it update?

2. **Generate HTML section**
   ```html
   <!-- New panel HTML -->
   <div class="panel">
       <div class="panel-header">
           <h2>üéØ [Panel Title]</h2>
       </div>
       <div class="panel-content">
           <div id="[panel-id]-content">Loading...</div>
       </div>
   </div>
   ```

3. **Generate JavaScript fetch code**
   ```javascript
   function update[PanelName](data) {
       const content = document.getElementById('[panel-id]-content');
       content.innerHTML = `...`;
   }
   ```

4. **Update data script if needed**
   - Modify `update_dashboard_json.py` to include new data
   - Test script locally

5. **Deploy changes**
   - Copy updated `index.html` to server
   - Copy updated script if modified
   - Verify on live URL

6. **Report success**
   ```
   ‚úÖ Added new panel: [Panel Name]
   
   Live: http://sites.thriveworks.tech/dashboard/
   
   Data source: status.json.[field]
   Updates: [frequency]
   ```

---

### 3. Edit Existing Panel

**Trigger:** "edit dashboard [panel-name]" / "change [panel] to [modification]"

**Examples:**
- "change email count to 5"
- "edit brain panel colors"
- "update bot squad to include 4 bots"

**Process:**

1. **Identify panel**
   - Which panel is being modified?
   - What specific change is requested?

2. **Modify backend script (if data change)**
   ```bash
   # Edit update_dashboard_json.py
   nano /root/.openclaw/workspace/scripts/update_dashboard_json.py
   
   # Example: Change email count
   MAX_EMAILS = 5  # Changed from 3
   ```

3. **Modify frontend (if display change)**
   ```bash
   # Edit index.html
   nano /var/www/sites/dashboard/index.html
   
   # Update HTML/CSS/JS as needed
   ```

4. **Test changes**
   ```bash
   # Run script manually to test
   python3 /root/.openclaw/workspace/scripts/update_dashboard_json.py
   
   # Check JSON output
   cat /var/www/sites/dashboard/status.json
   ```

5. **Deploy**
   ```bash
   # Copy files to server if edited locally
   scp index.html root@72.62.252.124:/var/www/sites/dashboard/
   ```

6. **Verify**
   - Hard refresh dashboard (Ctrl+Shift+R)
   - Confirm change is visible

7. **Report**
   ```
   ‚úÖ Updated [panel name]
   
   Changes:
   - [List what changed]
   
   Live: http://sites.thriveworks.tech/dashboard/
   ```

---

### 4. Update Data Scripts

**Trigger:** "update dashboard data" / "refresh dashboard" / "force dashboard update"

**Process:**

1. **Run main status updater**
   ```bash
   python3 /root/.openclaw/workspace/scripts/update_dashboard_json.py
   ```

2. **Run history updater**
   ```bash
   cd /var/www/sites/dashboard
   python3 update_history.py
   ```

3. **Run auth summary**
   ```bash
   cd /var/www/sites/dashboard
   bash update_auth_summary.sh
   ```

4. **Verify JSON files updated**
   ```bash
   # Check timestamps
   ls -la /var/www/sites/dashboard/*.json
   
   # Check status content
   cat /var/www/sites/dashboard/status.json | grep updated_at
   ```

5. **Report**
   ```
   ‚úÖ Dashboard data updated
   
   status.json: 08:21:00 SGT
   history.json: 08:00:00 SGT
   auth_summary.json: 08:00:00 SGT
   
   Refresh browser to see latest data.
   ```

---

### 5. Deploy Changes

**Trigger:** "deploy dashboard" / "upload dashboard changes"

**Process:**

1. **Determine what changed**
   - HTML/CSS/JS only? ‚Üí Deploy `index.html`
   - Scripts? ‚Üí Deploy to scripts directory
   - Both? ‚Üí Deploy all

2. **Deploy frontend**
   ```bash
   scp /path/to/index.html root@72.62.252.124:/var/www/sites/dashboard/
   ```

3. **Deploy scripts (if changed)**
   ```bash
   # Main updater
   scp /root/.openclaw/workspace/scripts/update_dashboard_json.py root@72.62.252.124:/root/.openclaw/workspace/scripts/
   
   # History updater
   scp /path/to/update_history.py root@72.62.252.124:/var/www/sites/dashboard/
   ```

4. **Set permissions**
   ```bash
   chmod 755 /var/www/sites/dashboard/index.html
   chmod +x /var/www/sites/dashboard/update_history.py
   ```

5. **Test scripts**
   ```bash
   # Run manually to verify no errors
   python3 /root/.openclaw/workspace/scripts/update_dashboard_json.py
   ```

6. **Verify live site**
   ```bash
   curl -I http://sites.thriveworks.tech/dashboard/
   ```

7. **Report**
   ```
   ‚úÖ Dashboard deployed
   
   Files updated:
   - index.html
   - update_dashboard_json.py
   
   Live: http://sites.thriveworks.tech/dashboard/
   Status: OK (200)
   ```

---

### 6. Sync Brain Mirror

**Trigger:** "sync brain mirror" / "update brain capacity"

**Process:**

1. **Copy workspace files to mirror**
   ```bash
   cp /root/.openclaw/workspace/*.md /var/www/sites/dashboard/brain_mirror/sarah/workspace/
   ```

2. **Verify files copied**
   ```bash
   ls -la /var/www/sites/dashboard/brain_mirror/sarah/workspace/
   ```

3. **Force history update**
   ```bash
   cd /var/www/sites/dashboard
   python3 update_history.py
   ```

4. **Check brain capacity data**
   ```bash
   cat /var/www/sites/dashboard/status.json | grep -A 20 "brain"
   ```

5. **Report**
   ```
   ‚úÖ Brain mirror synced
   
   Files copied:
   - SOUL.md (6.0 KB)
   - USER.md (4.6 KB)
   - IDENTITY.md (1.0 KB)
   - HEARTBEAT.md (2.1 KB)
   
   Total capacity: 45.2 KB (5.6%)
   
   Dashboard updated.
   ```

---

### 7. Troubleshoot

**Trigger:** "dashboard broken" / "fix dashboard" / "dashboard not working"

**Process:**

1. **Check JSON files exist**
   ```bash
   ls -la /var/www/sites/dashboard/*.json
   ```
   - If missing ‚Üí Run data scripts

2. **Validate JSON syntax**
   ```bash
   cat /var/www/sites/dashboard/status.json | python3 -m json.tool
   ```
   - If invalid ‚Üí Check script errors

3. **Check data freshness**
   ```bash
   cat /var/www/sites/dashboard/status.json | grep updated_at
   ```
   - If old ‚Üí Check cron jobs

4. **Verify cron jobs running**
   ```bash
   systemctl status cron
   grep CRON /var/log/syslog | tail -10
   ```
   - If not running ‚Üí Restart cron

5. **Test scripts manually**
   ```bash
   python3 /root/.openclaw/workspace/scripts/update_dashboard_json.py
   python3 /var/www/sites/dashboard/update_history.py
   ```
   - If errors ‚Üí Show error + suggest fix

6. **Check web server**
   ```bash
   curl -I http://sites.thriveworks.tech/dashboard/
   ```
   - If 404/500 ‚Üí Check file permissions

7. **Report findings**
   ```
   üîç Dashboard Diagnostics:
   
   JSON Files: ‚úÖ All present
   Syntax: ‚úÖ Valid
   Data Age: ‚ö†Ô∏è 2h old (should be < 5min)
   Cron: ‚úÖ Running
   Scripts: ‚ùå Error in update_dashboard_json.py
   Web Server: ‚úÖ OK (200)
   
   Issue: [Describe problem]
   Fix: [Suggest solution]
   ```

---

## Deployment Methods

### Method 1: Direct Server Edit (Quick fixes)

**When:** Small text changes, CSS tweaks

```bash
ssh root@72.62.252.124
nano /var/www/sites/dashboard/index.html
# Save (Ctrl+O, Enter, Ctrl+X)
# Refresh browser
```

---

### Method 2: SCP Upload (Recommended)

**When:** Major changes, testing needed locally first

```bash
# Edit locally, then upload
scp /path/to/index.html root@72.62.252.124:/var/www/sites/dashboard/
```

---

### Method 3: Full Directory Sync (Major updates)

**When:** Multiple files changed

```bash
scp -r /local/dashboard/* root@72.62.252.124:/var/www/sites/dashboard/
```

---

## Common Tasks Reference

| Task | Command |
|------|---------|
| View current status | `cat /var/www/sites/dashboard/status.json` |
| Force data update | `python3 /root/.openclaw/workspace/scripts/update_dashboard_json.py` |
| Update history | `python3 /var/www/sites/dashboard/update_history.py` |
| Sync brain mirror | `cp /root/.openclaw/workspace/*.md /var/www/sites/dashboard/brain_mirror/sarah/workspace/` |
| Deploy HTML | `scp index.html root@72.62.252.124:/var/www/sites/dashboard/` |
| Check dashboard live | `curl -I http://sites.thriveworks.tech/dashboard/` |
| View cron logs | `grep CRON /var/log/syslog \| tail -20` |

---

## Current Panels (Reference)

1. **API Usage** ‚Äî Faith/Guru/Codex token usage
2. **Bot Squad** ‚Äî John/Sarah/Ross online status
3. **Urgent Alerts** ‚Äî Recent emails, upcoming calendar
4. **Brain Capacity** ‚Äî Memory file sizes, total usage
5. **Historical Charts** ‚Äî Hourly/daily usage trends

---

## Notes

- **Always backup before major changes** (copy index.html to .bak)
- **Test scripts manually** before assuming cron will work
- **Hard refresh browser** (Ctrl+Shift+R) after changes
- **Check JSON timestamps** to verify data is fresh
- **Use nano for server edits** (easier than vim for Coach)

---

## Dependencies

**Required access:**
- Server SSH: `root@72.62.252.124`
- Dashboard directory: `/var/www/sites/dashboard/`
- Scripts directory: `/root/.openclaw/workspace/scripts/`
- Brain mirror: `/var/www/sites/dashboard/brain_mirror/`

**Required commands:**
- `scp` (file transfer)
- `nano` (text editor)
- `python3` (script execution)
- `curl` (web testing)

---

## Source

**Plan:** `lessons/dashboard-management-plan-2026-02-13.md`  
**Created:** 2026-02-13  
**Author:** Jack
